# ADVL Application — Setup Guide

> Generated by Cascade after completing the architecture scaffold.  
> Last updated: 2026-02-25

---

## Prerequisites

| Requirement | Version | Check |
|---|---|---|
| Node.js | >= 20.0.0 | `node --version` |
| pnpm | >= 9.0.0 | `pnpm --version` |
| Git | any | `git --version` |

Install pnpm if not present:
```bash
npm install -g pnpm
```

---

## Installation

```bash
# 1. Clone the repository (or navigate to it)
cd d:\Develope\advl\advl-app

# 2. Install all workspace dependencies
pnpm install

# 3. Copy environment variables
cp .env.example .env
```

Edit `.env` and fill in at minimum:
```
ADVL_LLM_API_KEY=your_openrouter_or_anthropic_key_here
```

---

## Running in Electron (Desktop) Mode

This starts the full desktop application: Core UI + Agent process + Electron shell.

```bash
pnpm dev
```

What happens:
1. Agent process starts on `ws://localhost:7433`
2. Core Vite dev server starts on `http://localhost:5173`
3. Electron loads Core from the Vite dev server
4. The `window.__ADVL_ELECTRON__` flag is injected → `ElectronAdapter` is used
5. Filesystem operations go through Electron IPC → OS directly

### Alternative: use the shell script
```bash
bash scripts/dev.sh
```

---

## Running in Server Mode

This starts ADVL as a web server accessible from any browser on the network.

```bash
# Build Core first (server mode serves pre-built static files)
pnpm --filter core build

# Start server + agent
pnpm dev-server
```

Then open: **http://localhost:3000**

What happens:
1. Agent process starts on `ws://localhost:7433`
2. Express server starts on `http://localhost:3000`
3. Express serves the pre-built Core from `packages/core/dist/`
4. Browser connects → no `__ADVL_ELECTRON__` → `BrowserAdapter` is used
5. Filesystem operations go through `POST /api/filesystem/*` → server → OS

### Alternative: use the shell script
```bash
bash scripts/dev-server.sh
```

---

## Building for Production

```bash
bash scripts/build.sh
```

Builds in order: `shared` → `core` → `agent` → `electron` → `server`

### Package as Desktop App (Electron)

```bash
bash scripts/package-electron.sh
```

Output: `packages/electron/release/`

### Run as Server in Production

```bash
# After running build.sh:
node packages/server/dist/index.js
```

---

## Environment Variables

All variables are documented in `.env.example`. Key ones:

| Variable | Default | Description |
|---|---|---|
| `ADVL_LLM_API_KEY` | — | **Required.** Your LLM API key |
| `ADVL_LLM_PROVIDER` | `openrouter` | `openrouter` \| `anthropic` \| `openai` |
| `ADVL_LLM_MODEL` | `anthropic/claude-sonnet-4-6` | Model identifier |
| `ADVL_AGENT_PORT` | `7433` | WebSocket port for the agent |
| `ADVL_SERVER_PORT` | `3000` | HTTP port for server mode |
| `ADVL_SERVER_AUTH_ENABLED` | `false` | Set `true` for multi-user hosted mode |

---

## Project Structure

```
advl-app/
├── packages/
│   ├── shared/         ← Shared TypeScript types and constants
│   ├── core/           ← React + Vite UI (runs in Electron or browser)
│   ├── agent/          ← Node.js AI agent process (WebSocket server)
│   ├── electron/       ← Electron desktop shell
│   └── server/         ← Express server shell
├── rules/              ← ADVL rulebook files (6 MD files)
├── schema/             ← DCM.yaml + DCM_SCHEMA.md
├── scripts/            ← Dev, build, and package scripts
└── .env.example        ← Environment variable template
```

---

## Adding a New Platform Adapter

To add a new platform target (e.g., Tauri, VS Code extension):

1. Create `packages/core/src/platform/adapter.[name].ts`
2. Implement all methods from `IPlatformAdapter` (in `adapter.interface.ts`)
3. Add detection logic to `adapter.factory.ts`
4. No changes needed to Core features — they only use the `platform` singleton

---

## Working with the DCM

The Data Communication Matrix lives at `schema/DCM.yaml`.

```bash
# View current DCM
cat schema/DCM.yaml
```

The DCM is the source of truth for all use cases, functions, and endpoints.  
**Never edit manually** without understanding the schema (see `schema/DCM_SCHEMA.md`).  
**Never add a function to code** without first registering it in the DCM.

---

## Known Limitations at This Stage (v0.1.0)

- **Agent handlers are stubs** — `agent.core.ts` handlers return TODO responses. LLM-driven use case translation and code generation are not yet implemented.
- **DCM query is not semantic** — `dcmEngine.queryFunctions()` does not yet perform semantic matching. It always returns `found: false`. Full implementation requires embeddings or LLM classification.
- **Electron dev mode requires tsx** — The agent is started with `tsx` in dev mode. Ensure `tsx` is installed globally or add it to the root workspace dev dependencies.
- **No persistence for window state** — Electron window size/position resets on each launch. Requires `electron-store` to persist.
- **Browser adapter's `openFolderDialog`** — Uses `window.prompt()` as a temporary fallback. Should be replaced with a proper UI modal.
- **Core builds required for server mode** — Server mode cannot run without a prior `pnpm --filter core build`.
- **Auth middleware is a stub** — `auth.middleware.ts` logs a warning but passes all requests. Implement before exposing on a public network.

---

*ADVL Architecture v0.1.0 — Amadeus Lederle / IEX Labs UG (haftungsbeschränkt)*  
*License: Commons Clause + MIT*
